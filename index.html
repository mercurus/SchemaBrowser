<!DOCTYPE html> 
<!--

This allows you to browse a SQL template dynamically
after being parsed (by my TemplateParser.java) 
into var_schema.js as a JSON object that looks like this:

var schema = {
	"accounts":{
		"constraints":[
			"PRIMARY KEY (`id`)",
			"UNIQUE KEY `account-name` (`name`)",
			...
		],
		"fields":{
			"id":{"sequence":0, "nullable":"NOT NULL", "datatype":"int(10) unsigned", "comment":"AUTO_INCREMENT "},
			"name":{"sequence":1, "nullable":"NOT NULL", "datatype":"varchar(50)"},
			"short_name":{"sequence":2, "datatype":"varchar(50)", "defaultValue":"NULL"},
			...
		}
	},
	"users":{
		"constraints":[
			"PRIMARY KEY (`id`)",
			"UNIQUE KEY `login_name` (`login_name`,`account_id`)",
			"CONSTRAINT `users_ibfk_1` FOREIGN KEY (`account_id`) REFERENCES `accounts` (`id`) ON DELETE CASCADE",
			...
		],
		"fields":{
			"id":{"sequence":0, "nullable":"NOT NULL", "datatype":"int(10) unsigned", "comment":"AUTO_INCREMENT "},
			"account_id":{"sequence":1, "fkField":"id", "fkTable":"accounts", "nullable":"NOT NULL", "datatype":"int(10) unsigned"},
			"email":{"sequence":2, "datatype":"varchar(225)", "defaultValue":"NULL"},
			"first_name":{"sequence":3, "datatype":"varchar(50)", "defaultValue":"NULL"},
			...
		}
	},
	...
};


Constraints are just plain text in an array
Tables that are actually views should have the view declaration as the constraint
although I'm just remembering that it assumes the entire create view statement is on one line...


Fields are more complicated and can contain:
datatype
nullable
defaultValue
comment
fkTable
fkField
sequence (I don't know how else to get them to sort properly)


Enumerators can also be shown if you store them in enumerators.js
as a JSON object that looks like this:

var enumerators = {
	"account_documents": { //table name
		"document_type": { //field name
			"java_type": "Document.DocumentType",
			"0": "HTM/HTML",
			"1": "PDF",
			"2": "TXT",
			"3": "JPG/JPEG",
			"4": "GIF",
			"5": "TGA",
			"6": "TIF/TIFF",
			"7": "PNG",
			"8": "DOC/DOCX",
			"9": "XLS",
			"10": "PPT/PPTX",
			"11": "ZIP",
			"12": "GZ",
			"13": "TAR",
			"14": "TGZ",
			"15": "RAR",
			"16": "XLSX"
		}
	},
	"account_npo": { //table name
		"source": {  //field name
			"java_type": "NpoSource",
			"0": "OTHER",
			"1": "IRS",
			"2": "CAN/CRA",
			"3": "NCES",
			"4": "IPEDS"
		},
		"status_type": { //field name
			"java_type": "DomainObjectCreationStatus.DomainObjectCreationStatusType",
			"1": "Created",
			"2": "Modified",
			"3": "Archived"
		},
		"eligibilities": { //field name
			"java_type": "AccountNpo.NpoEligibility",
			"bit 0": "CRA Eligible",
			"bit 1": "Grant Elgibile",
			"bit 2": "Giving Eligible"
		},
		...
	},
	...
};


And finally you can include groups of tables in table_groups.js
as a JSON object that looks like this:

var table_groups = {
	"surveys":["surveys", "survey_questions", "questions", "question_choice_sets", "choice_sets", "choices", "branch_processors", "branch_processors_properties"],
	"giving":["giving_program", "giving_configuration"],
	...
};


Commands:
!commands or !help - show all options
!showall - shows all tables
!closeall - close all tables
!showtags - show table tags
!hidetags - hide table tags
@table - show table and all tables it directly relates to
#table - show table and all tables that relate to it
$group - show group from table_groups.js


If it's acting weird talk to
Ryan Hunt rhunt@microedge.com

-->

<html>
<head>
	<title>Schema Browser</title>
	<link rel="stylesheet" href="stylesheet.css" />
<body>
	<div id="wrapper">
		<div id="control_panel">
			<span>Table: </span>
			<select id="combo_tables" onchange="showTable(this.value);"> </select>
			<span>!commands / search: </span>
			<input id="text_input" type="text" onkeyup="textEnter(event);" />
			<div id="all_table_tags">
				<span style="float:left">Table tags: </span>
			</div>
		</div>
		<div id="display_container" onmousedown="hidePopup();"> </div>
		<div id="popup"> </div>
	</div>
	<script src="var_schema.js"></script>
	<script src="schema_display.js"></script>
	<script> var enumerators = {}; </script>
	<script src="enumerators.js"></script> <!-- you can comment out enumerators.js if you don't have it -->
	<script> var table_groups = {}; </script>
	<script src="table_groups.js"></script> <!-- you can comment out table_groups.js if you don't have it -->
</body>
</html>
